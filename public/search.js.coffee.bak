$ ->
  search_users = new Bloodhound(
    datumTokenizer: Bloodhound.tokenizers.obj.whitespace
    queryTokenizer: Bloodhound.tokenizers.whitespace
    remote:
      url: '/search?q=%QUERY'
      filter: (data) ->
        data.users
  )
  search_products = new Bloodhound(
    datumTokenizer: Bloodhound.tokenizers.obj.whitespace
    queryTokenizer: Bloodhound.tokenizers.whitespace
    remote:
      url: '/search?q=%QUERY'
      filter: (data) ->
        data.products
  )
  search_users.initialize()
  search_products.initialize()
  $('#search.typeahead').typeahead { highlight: true }, {
    name: 'users'
    displayKey: 'name'
    source: search_users.ttAdapter()
    templates: 
      header: "<h4 class='pad1x'>Users</h4>"
      suggestion: Handlebars.compile("<strong>{{name}}</strong> <small class='quiet inline'>{{id}}</small>")
  },
    name: 'products'
    displayKey: 'name'
    source: search_products.ttAdapter()
    templates: 
      header: "<h4 class='pad1x'>Products</h4>"
      suggestion: Handlebars.compile("<strong>{{name}}</strong> <small class='quiet inline'>{{id}}</small>")
